---
layout: post
title: 【曹操傳】EXE 修改詳解 - 關於經驗擴充到 200 的修改方法
tags: [CaoCaoZuan]
---

原文出自 [轩辕春秋文化论坛 » 曹操传MOD制作交流 » 曹操传EXE修改详解](http://xycq.online/forum/viewthread.php?tid=82183&extra=page%3D4&authoruid=0&page=1)，僅做繁體化與排版調整。

> 版权归"轩辕春秋文化论坛"所有，作者：慕容雪芸。

<!-- more -->


修改的思路和一些解釋：其實這個主要是位元組間的變換，將單位元組變雙位元組問題，下面看看一些簡單的解釋。

用 OllyDbg 打開 CCZ 的 **EXE**
查看有關經驗的語句：

```
0040897E    83EA 64       SUB EDX,64
00408984    837D 08 64     CMP DWORD PTR SS:[EBP+8],64
00450159    83F9 64       CMP ECX,64
0045016B    BA 64000000   MOV EDX,64
00451156    F8 64000000   MOV DWORD PTR SS:[EBP-8],64
0045116E    C745 10 64000000   MOV DWORD PTR SS:[EBP+10],64
0045133E    6A 64         PUSH 64
00451354    6A 64         PUSH 64
00479519    C745 EC 64000000    MOV DWORD PTR SS:[EBP-14],64
```

其中的 64 分別對應 `UE` 的這九個地方：7d80、7d87、4f55B、4f56c、50559、50571、5073f 、50755、7891C

然後試著用 `UE` 修改，改為 0x80（128）時，可以發現一件事有的地方經驗值顯示變成 -80 了，比如：

```
0040897E      83EA 80             SUB EDX,-80
```

變為負值的總共有以下五個地方：0040897E、00408984、00450159、0045133E、00451354

比較其中的不同，可以發現一件事，其它幾個都不是單位元組，後面都多了 00 00 00，不管其它的，不改寫函數的話，最簡單的辦法就是用跳轉來實現，把部份寫不下的內容移到別的地方去，把單位元組變換一下，經測試，經驗上限達到 9999 也能正常升級  再高的沒有測試，估計是沒有問題的，當然你要是改為 FFFFFFFF，那當我沒說。

大致上的修改就這樣了，還要注意的一點就是相關的跳轉要修改一下，比如這一句：
```
0045133C  75 16               JNZ SHORT Ekd.00451354
```

例如偶的經驗變 200 中的第一句，就寫成這樣子：
```
0040897E      81EA C8000000 SUB EDX,0C8
```

大家可以對比一下有什麼樣的不同。

經驗上限擴充到200的實際修改：
注意：利用了擴充戰場形象留下的空間（即：必須先使用——周瑜或是葉落的戰場形象擴展補丁）


### 匯編修改法：
以下為內存中的匯編碼和機器碼，請使用匯編工具修改，如果用 `UE` 修改的，請看下面的部份。

```
00408979　 EB 0C　　　　 JMP SHORT 00408987

0040897E      81EA C8000000  SUB EDX,0C8
00408984      8955 08        MOV DWORD PTR SS:[EBP+8],EDX
00408987      817D 08 C8000000  CMP DWORD PTR SS:[EBP+8],0C8
0040898E      72 0A          JB SHORT EKD5.0040899A
00408990      8B45 0C        MOV EAX,DWORD PTR SS:[EBP+C]
00408993      E9 7EE3FFFF    JMP EKD5.00406D16

00450159      81F9 C8000000 CMP ECX,0C8
0045015F      76 14         JBE SHORT EKD5.00450175
00450161      8B4D C4       MOV ECX,DWORD PTR SS:[EBP-3C]
00450164      E9 BD6BFBFF   JMP EKD5.00406D26
00450169      90            NOP
0045016A      90            NOP
0045016B      BA C8000000   MOV EDX,0C8

00451156      C745 F8 C8000000 MOV DWORD PTR SS:[EBP-8],0C8

0045116E      C745 10 C8000000 MOV DWORD PTR SS:[EBP+10],0C8

0045133C     75 13          JNZ SHORT Ekd5.00451351
0045133E      68 C8000000   PUSH 0C8
00451343      68 E4E24800   PUSH EKD5.0048E2E4
00451348      E9 E859FBFF   JMP EKD5.00406D35
0045134D      90            NOP
0045134E      90            NOP
0045134F      90            NOP
00451350      90            NOP
00451351      68 C8000000   PUSH 0C8

00479519      C745 EC C8000000 MOV DWORD PTR SS:[EBP-14],0C8

00406D16      50            PUSH EAX
00406D17      6A 01         PUSH 1
00406D19      8B4D F8       MOV ECX,DWORD PTR SS:[EBP-8]
00406D1C      E8 97060000   CALL EKD5.004073B8
00406D21      E9 551C0000   JMP EKD5.0040897B
00406D26      E8 25F9FFFF   CALL EKD5.00406650
00406D2B      25 FF000000   AND EAX,0FF
00406D30      E9 36940400   JMP EKD5.0045016B
00406D35      68 382F4900   PUSH EKD5.00492F38
00406D3A      E8 618D0000   CALL EKD5.0040FAA0
00406D3F      83C4 0C       ADD ESP,0C
00406D42      E9 25A60400   JMP EKD5.0045136C
```

### UE修改法：

1. 7D7E~7D97 處 : 81 EA C8 00 00 00 89 55 08 81 7D 08 C8 00 00 00 72 0A 8B 45 0C E9 7E E3 FF FF
2. 4F559~4F56F 處 : 81 F9 C8 00 00 00 76 14 8B 4D C4 E9 BD 6B FB FF 90 90 BA C8 00 00 00
3. 50559~5055A 處 : C8 00
4. 50571~50572 處 : C8 00
5. 5073D~50755 處 : 13 68 C8 00 00 00 68 E4 E2 48 00 E9 E8 59 FB FF 90 90 90 90 68 C8 00 00 00
6. 7891C~7891D 處 : C8 00
7. 6116~6146 處 : 50 6A 01 8B 4D F8 E8 97 06 00 00 E9 55 1C 00 00 E8 25 F9 FF FF 25 FF 00 00 00 E9 36 94 04 00 68 38 2F 49 00 E8 61 8D 00 00 83 C4 0C E9 25 A6 04 00
8. 7D7A 處改為 0C

用 `UE` 修改後，經驗上限修改位置
1. 7D80~7D81 處
2. 7D8A~7D8B 處
3. 4f55B~4055C 處
4. 4F56C~4F56D
5. 50559~5055A 處
6. 50571~50572 處
7. 5073F~50740 處
8. 50752~50753 處
9. 7891C~7891D 處

此處都為 C8 00，也就是 0x0C8，（十進制的200），`UE` 修改時要注意 **前後對倒** 這一點。如經驗上限 300，0x12C 倒過來也就是 2C 01。